/* file: amm_personalisedBlocks.js - v1.0.1 | minified on 2011/01/31 with http://jscompress.com/ */
function userPersonnalisedBlockManage(opt,keys,token,initValues)
{var options={ajaxUrl:'plugins/AMenuManager/amm_ajax.php'},translatedKeys={g002_ok:'g002_ok',g002_cancel:'g002_cancel',g002_loading:'g002_loading',g002_editofpersonalised:'g002_editofpersonalised',g002_createofpersonalised:'g002_createofpersonalised'},properties={id:'',token:token},load=function()
{$('#iList').html("<br>"+translatedKeys.g002_loading+"<br><img src='./plugins/GrumPluginClasses/icons/processing.gif'>");$.ajax({type:"POST",url:options.ajaxUrl,async:true,data:{ajaxfct:"admin.blocks.list"},success:function(msg)
{$("#iList").html(msg);}});},edit=function(blockId)
{properties.id=blockId;$('#iDialogEdit').dialog('option','title',(blockId=='')?translatedKeys.g002_createofpersonalised:translatedKeys.g002_editofpersonalised).dialog("open");},remove=function(blockId)
{properties.id=blockId;$.ajax({type:"POST",url:options.ajaxUrl,async:true,data:{ajaxfct:"admin.blocks.delete",id:properties.id,token:properties.token},success:function(msg)
{load();}});},checkValidity=function()
{$('.error').removeClass('error');ok=true;return(ok);},updateDialog=function(items)
{if(items=='')
{$('#iamm_personalised_nfo').inputText('value','');$('#iamm_personalised_title').inputText('value','').inputText('languagesValues',':clear');$('#iamm_personalised_content').inputText('value','').inputText('languagesValues',':clear');$('#iamm_personalised_visible').inputRadio('value','y');}
else
{var tmp=$.parseJSON(items),titles={},contents={};for(var lang in tmp.langs)
{titles[lang]=tmp.langs[lang].title;contents[lang]=tmp.langs[lang].content;}
$('#iamm_personalised_nfo').inputText('value',tmp.nfo);$('#iamm_personalised_title').inputText('languagesValues',':clear').inputText('languagesValues',titles);$('#iamm_personalised_content').inputText('languagesValues',':clear').inputText('languagesValues',contents);$('#iamm_personalised_visible').inputRadio('value',tmp.visible);}},doUpdate=function()
{displayProcessing(true);var langs=[],titles=$('#iamm_personalised_title').inputText('languagesValues'),contents=$('#iamm_personalised_content').inputText('languagesValues');for(var lang in titles)
{langs.push({lang:lang,title:titles[lang],content:contents[lang]});}
var datas={nfo:$('#iamm_personalised_nfo').inputText('value'),visible:$('#iamm_personalised_visible').inputRadio('value'),langs:langs};$.ajax({type:"POST",url:options.ajaxUrl,async:true,data:{ajaxfct:"admin.blocks.set",id:properties.id,token:properties.token,datas:datas},success:function(msg)
{displayProcessing(false);if(msg.match(/^[0-9]+$/i)!=null)
{$('#iDialogEdit').dialog("close");load();}
else
{returned=msg.split('!');$('#'+returned[0]).addClass('error');alert(returned[1]);}}});},displayProcessing=function(visible)
{if(visible)
{$('#iBDProcessing').css("display","block");}
else
{$('#iBDProcessing').css("display","none");}},init=function(initValues)
{var buttons={};buttons[translatedKeys.g002_ok]=function()
{if(checkValidity())doUpdate();};buttons[translatedKeys.g002_cancel]=function()
{$('#iDialogEdit').dialog("close");};$('#iDialogEdit').dialog({autoOpen:false,width:800,height:480,modal:true,dialogClass:'gcBgTabSheet gcBorder',title:'',buttons:buttons}).bind('dialogopen',function()
{if(properties.id!='')
{displayProcessing(true);$.ajax({type:"POST",url:options.ajaxUrl,async:true,data:{ajaxfct:"admin.blocks.get",id:properties.id},success:function(msg)
{updateDialog(msg);displayProcessing(false);}});}
else
{updateDialog('');}});$('#islang').inputList({popupMode:'mouseout'});$('#iamm_personalised_nfo').inputText({displayChar:75,maxChar:255});$('#iamm_personalised_title').inputText({displayChar:75,maxChar:255,languages:initValues.langs,currentLanguage:initValues.userLang,languageSelector:'islang'});$('#iamm_personalised_content').inputText({multilines:true,displayChar:70,numRows:13,languages:initValues.langs,currentLanguage:initValues.userLang,languageSelector:'islang'});$('#islang').inputList('value',initValues.userLang);$('#iamm_personalised_visible').inputRadio();load();};$.extend(options,opt);$.extend(translatedKeys,keys);this.load=function(){load();};this.edit=function(linkId){edit(linkId);};this.remove=function(linkId){remove(linkId);};init(initValues);}
